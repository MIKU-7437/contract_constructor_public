![img](docs/img/preview.jpg)

# Конструктор интерактивной документации

## Цель проекта

Разработка приложения, позволяющего создавать конструкторы документов.
Конструктор документов - адаптивная анкета, генерирующая валидную документацию на основе заложенного шаблона,
динамической анкеты и пользовательского ввода.

## Описание
Логика конструктора основана на ациклическом направленном графе с возможностью задания логических связей между узлами. 
Реализованы связи типа `==`, `!=`, `>`, `<`, `>=` и `<=`.
Такая структура даёт пользователю возможность создавать анкеты с широкой вариативностью сценариев заполнения. 
Приложение упрощает работу с документами, требующими частого изменения и ситуативной адаптации: договоры, инструкции и т.д.
Результат заполнения конечный пользователь может скачать в виде *.docx документа.

В репозитории представлена серверная часть клиент-серверного приложения.
Бэкенд отвечает за соблюдение логики графа, расчет связей между узлами, актуализацию их состояния и хранение в БД.

Также на стороне бэкенда происходит конвертация документа *.docx в *.html для первичной генерации шаблона и обратно, для выгрузки сформированного документа пользователю.

### [Стенд проекта](http://f0880989.xsph.ru/)
### [API документация](https://api-publisher.crabdance.com/swagger/contract-constructor)


## Зависимости

- Фреймворк: Fastapi
- База данных: PostgreSQL
- Авторизация и аутентификация: JWT токен
- Конвертертация docx <-> html: mammoth, pypandoc

## Развертывание (docker compose)

- Переименовать `.env.example` в  `.env.docker`
- Заполнить обязательные параметры в `.env`
- Установить Docker
- Перенести на сервер проект и файл .env.docker

```bash
docker compose -f docker-compose.yml up -d --build
```
Приложение запустится после сборки контейнера

### Создание суперпользователя
```bash
docker exec <имя контейнера приложения> python cli_create_superuser.py 
```

### Наполнение демо аккаунта
Бэкенд предусматривает механику создания демо аккаунтов с ограниченным временем жизни.
Для создания дефолтного наполнения демо аккаунтов есть возможность сохранить нужный проект в файловой системе и 
использовать его при генерации демо аккаунтов.

Для сохранения проекта в качестве дефолтного наполнения демоакаунта:
```bash
docker exec <имя контейнера приложения> python cli_demo_project.py dump 24
```
Подробнее: `src/cli_demo_project.py`

## Администрирование
Панель администратора реализована на `sqladmin` и предоставляет скромный функционал для 
управления аккаунтами и их доступом.

## Авторизация
Реализована с использованием JWT и refresh токенов на основе сессий.

## Как запустить тесты
```bash
python -m unittest
```

## Особоенности архитектуры:
- Работа с базой данных происходит через ORM SQLAlchemy
- `src/admin_panel` - конфигурации админ панели
- `src/background` - обработчики фоновых задач, чистка файлов, удаление демо аккаунтов и т.д.
- `src/converter` - конвертер файлов docx <-> html
- `src/graph_processing` - интерпретатор графа
- `src/usecases` - рализация бизнес логики
