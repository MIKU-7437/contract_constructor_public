# Виды узлов, разрешенные значения и описания

--- 

## Общее описание полей узла

Типовая структура с одним узлом. ID узла хранится в ключе. 
```bash
{
"4": {
    "parent_id": 1,
    "name": "Имя узла",
    "description": "узел c радиобатоном - единственный выбор." 
    "data_type": "string",
    "node_type": "select",
    "options": ["красный","зелёный","синий"]
    "content": "зелёный",
    "condition": null,
    "trigger": null,
    "x": 100,
    "y": 100,
    "active": true,
    "view_type": "radiobutton"
  }
}
```
### Описание полей
- `parent_id` - id родительского узла
- `name` - имя узла (ограничение длины пока не добавлял, выясним позже)
- `description` - описание узла (описаине можно отобразить всплывающей подсказкой при наведении курсора на узел или поле анкеты)
- `data_type` - тип данных, который будет лежать в `content` узла
- `node_type` - тип узла, как рисовать его на фронте и как обсчитывать на бэке. 
Для разных типов могут быть разные ограничения по типу данных в `content`. Подробнее в разделе "Разрешенные значения"
- `content` - главное поле, где хранится содержимое узла
- `condition` - поле определяет зависимость узла и может содержать один из операторов
- `trigger` - поле, с которым будет сравниваться родительский `condition`. Должно быть одного типа с этим `condition`
- `x` - содержит координаты расположения для отрисовки на фронте
- `y` - содержит координаты расположения для отрисовки на фронте
- `active` - поле, указывающее для фронта включен блок или выключен.
На бэк отправлять смысла нет, ибо оно всё равно не будет учитываться и пересчитается заново. 
- `options` - поле с вариантами для выпадающего списка или радиобаттона
- `view_type` - поле, указывающее способ отрисовки (выпадающий список/радиобаттон)   **-NEW!**

### Все возможные значения полей
Некоторые поля имеют ограничения в выборе значений или зависят от типа узла, см. ссылки.

- `parent_id`: str, null (необязательное поле)
- `name`: str (**обязательное поле!**)
- `description`: str, float, int, null (необязательное поле)
- `data_type`: (см. Разрешенные значения), (**обязательное поле!**)  
- `node_type`: (см. Разрешенные значения), (**обязательное поле!**)
- `content`: bool, str, float, int, null  (необязательное поле)
- `condition`: (см. Разрешенные значения), null, (необязательное поле)
- `trigger`: bool, str, float, int, null, (необязательное поле)
- `x`: int, null  (необязательное поле)
- `y`: int, null  (необязательное поле)
- `active`: bool  (необязательное поле)
- `options`: list(str, float), (необязательное поле)
- `view_type`: (см. Разрешенные значения), (необязательное поле)   **-NEW!**

Необязательные поля можно вообще не передавать, они заполнятся значениями по умолчанию. 
Как правило это null или пустой массив для `options`

--- 

## Разрешенные значения и операции

### Для `node_type` 
- "text"
- "entry"
- "checkbox"
- "select"   **-NEW!**

От указания типа зависит набор разрешенных для узла значений на бэке и его отрисовка на фронте

### Для `data_type` - типы данных в content узла
- "string"
- "integer"  (это значение и для int и для float)
- "bool"

`data_type` относится только к `content` узла.
Всё помеченное как integer, в поле `content` конвертится во float, поэтому можно передавать и int и float. 

### Для `condition` - оператор сравнения
- "gt"
- "lt"
- "gte"
- "lte"
- "equal"
- "not_equal"

### Для `view_type` - тип отрисовки выпадающего списка   **-NEW!**
- "drop_list"  **-NEW!**
- "radiobutton"  **-NEW!**

### Разрешенные типы данных для операторов сравнения
- **"gt"**: "integer"  
- **"lt"**: "integer"  
- **"gte"**: "integer"  
- **"lte"**: "integer"  
- **"equal"**: "integer", "string", "bool"
- **"not_equal"**: "integer", "string", "bool"


### Разрешенные типы данных для поля `content` в зависимости от типа узла 
- **"text"**: "string", "integer"
- **"entry"**: "string", "integer"
- **"checkbox"**: "bool"
- **"select"**: "string", "integer"  **-NEW!**

---

## Проверки пользовательского ввода на стороне фронта
Безусловно, бэк ответит соответствующим текстом ошибки на некорректные данные, 
но куда быстрее сделать хотя бы часть проверок на стороне фронта и дать пользователю быструю обратную связь.
Что можно проверять:
- в первую очередь соответствие полей разрешенным типам данных, этому посвящен раздел "Разрешенные значения и операции".
- ограничения по количеству символов (их пока не обсуждали, но стоит выяснить позже для всех полей с польз. вводом)
- установление связи: если заполнены 3 компонета (condition, trigger и родительский content), стоит проверить,
чтобы trigger текущего узла и content родительского были одного типа. Также стоит проверить соответствует ли тип данных оператору 
в текущем узле (подробнее в "Разрешенные типы данных для операторов сравнения")

- `Важно! Если trigger или condition пустые (null), зависимость не будет рассчитываться и связанные блоки будут работать как обычные.`   **-NEW!**
- `Если отсутствует только content родителя, зависимые блоки будут неактивны`  **-NEW!**
---

## Ограничения при смене типа узла
**смена типа на "select"** - так как в поле options помещаются варианты выпадающего списка, поле content должно содержать один из этих 
вариантов или null. Поэтому одновременно с изменением типа узла нужно отредактировать content или options.
**смена типа на "checkbox"** - так как checkbox может содержать в своём content только bool значение, одновременно со сменой
типа узла на "select" стоит поменять и данные в content.
Подобные нюансы касаются и всех остальных узлов, т.к разрешенные значения content могут быть недопустимы для других. 
И изменение только поля node_type может вызвать ошибку. 
---

## Примеры разных типов узлов
```bash
{	
	"1": {
		"parent_id": null,
		"name": "ТЕКСТ",
		"description": "ТЕКСТ",
		"data_type": "string",
		"node_type": "text",
		"content": "Рандомный текст или число",
		"condition": null,
		"trigger": null,
		"x": 100,
		"y": 100,
		"active": true
	},	
	
	"2": {
		"parent_id": 1,
		"name": "ПОЛЕ ВВОДА",
		"description": "ПОЛЕ ВВОДА",
		"data_type": "string",
		"node_type": "entry",
		"content": "Рандомный текст или число",
		"condition": null,
		"trigger": null,
		"x": 100,
		"y": 100,
		"active": true
	},
	
	"3": {
		"parent_id": 1,
		"name": "ЧЕКБОКС",
		"description": "ЧЕКБОКС",
		"data_type": "bool",
		"node_type": "checkbox",
		"content": true,
		"condition": null,
		"trigger": null,
		"x": 100,
		"y": 100,
		"active": true
	},
	
    "4": {
		"parent_id": 1,
		"name": "ВЫПАДАЮЩИЙ СПИСОК",
		"description": "ВЫПАДАЮЩИЙ СПИСОК",	
		"data_type": "string",
		"node_type": "select",
		"options": ["красный","зелёный","синий"]
		"content": "зелёный",
		"condition": null,
		"trigger": null,
		"x": 100,
		"y": 100,
		"active": true,
		"view_type": "radiobutton"
	},
	
	"5": {
		"parent_id": 2,
		"name": "ПРИМЕР ЗАВИСИМОСТИ",
		"description": "Если content родителя не равен 'число', блок получит в свой 'active' значение false",	
		"data_type": "integer",
		"node_type": "text",
		"content": "Рандомный текст",
		"condition": "equal", 
		"trigger": "число",
		"x": 100,
		"y": 100,
		"active": false 
	}
}
]
```
